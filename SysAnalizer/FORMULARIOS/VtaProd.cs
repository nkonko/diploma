// <auto-generated/>
namespace UI
{
    using BE.Entidades;
    using BLL;
    using System;
    using System.Windows.Forms;

    public partial class VtaProd : Form, IVtaProd
    {
        private readonly IVentaBLL ventaBLL;
        private readonly IProductoBLL productoBLL;
        private readonly IProductos productos;
        private readonly IClienteBLL clienteBLL;
        private readonly IClientes cliente;
        private readonly IFormControl formControl;
        public Cliente ClienteSeleccionado { get; set; } = new Cliente();
        public Producto ProductoSeleccionado { get; set; } = new Producto();
        public Venta VentaSeleccionada { get; set; } = new Venta();
        public Usuario UsuarioActivo { get; set; } = new Usuario();

        public VtaProd(IVentaBLL ventaBLL, IProductoBLL productoBLL, IProductos productos, IClienteBLL clienteBLL, IClientes cliente, IFormControl formControl)
        {
            this.ventaBLL = ventaBLL;
            this.productoBLL = productoBLL;
            this.productos = productos;
            this.cliente = cliente;
            this.clienteBLL = clienteBLL;
            this.formControl = formControl;
            InitializeComponent();
        }

        public enum TipoVenta
        {
            notUsed,
            Seña,
            VentaSimple,
            Cliente,
            Devolucion,
        }

        private void label1_Click(object sender, EventArgs e)
        {
        }

        private void label2_Click(object sender, EventArgs e)
        {
        }

        private void dataGridView1_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            VentaSeleccionada = (Venta)dgVenta.CurrentRow.DataBoundItem;
        }

        private void VtaProd_Load(object sender, EventArgs e)
        {
            lblFecha.Text = DateTime.UtcNow.ToString();
            UsuarioActivo = formControl.ObtenerInfoUsuario();
        }

        private void btnFinalizar_Click(object sender, EventArgs e)
        {
            if (radioVtaSimple.Checked)
            {
                ventaBLL.Crear(new Venta()
                {
                    ClienteId = 0,
                    Fecha = DateTime.UtcNow,
                    TipoVentaId = 2,
                    EstadoId = 2,
                    Monto = int.Parse(txtCant.Text) * ProductoSeleccionado.PVenta,
                    Usuario = UsuarioActivo,
                    UsuarioId = UsuarioActivo.UsuarioId,
                });
            }

            if (radioVtaCC.Checked)
            {
                ventaBLL.Crear(new Venta()
                {
                    ClienteId = ClienteSeleccionado.ClienteId,
                    Fecha = DateTime.UtcNow,
                    TipoVentaId = 3,
                    EstadoId = 1,
                    Monto = int.Parse(txtCant.Text) * ProductoSeleccionado.PVenta,
                    Usuario = UsuarioActivo,
                    UsuarioId = UsuarioActivo.UsuarioId,
                });
            }

            if (rbSe.Checked)
            {
                ventaBLL.Crear(new Venta()
                {
                    ClienteId = ClienteSeleccionado.ClienteId,
                    Fecha = DateTime.UtcNow,
                    TipoVentaId = 1,
                    EstadoId = 1,
                    Monto = int.Parse(txtCant.Text) * ProductoSeleccionado.PVenta,
                    Usuario = UsuarioActivo,
                    UsuarioId = UsuarioActivo.UsuarioId,
                });
            }

            dgVenta.DataSource = ventaBLL.Cargar();
        }

        private void btnVolver_Click(object sender, EventArgs e)
        {
            this.Hide();
        }

        private void btnSelCliente_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrWhiteSpace(txtCodProd.Text))
            {
                var resultado = cliente.ShowDialog();
                if (resultado == DialogResult.OK)
                {
                    ClienteSeleccionado = cliente.ObtenerClienteSeleccionado();
                }
            }
            else
            {
            }
        }

        private void btnSelProd_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrWhiteSpace(txtCodProd.Text))
            {
                var resultado = productos.ShowDialog();
                if (resultado == DialogResult.OK)
                {
                    ProductoSeleccionado = productos.GetProductoSeleccionado();
                }
            }
            else
            {
                ProductoSeleccionado = productoBLL.ObtenerProductoPorCodigo(txtCodProd.Text);
            }
        }

        private void lblFecha_Click(object sender, EventArgs e)
        {

        }

        private void VtaProd_FormClosing(object sender, FormClosingEventArgs e)
        {
            Hide();
            e.Cancel = true;
        }

        private void btnCancelarVta_Click(object sender, EventArgs e)
        {
            ClienteSeleccionado = null;
            ProductoSeleccionado = null;
            txtCant.Text = "";
            txtCodProd.Text = "";
        }
    }
}
